# Инструкция по развертыванию и обновлению

## Быстрый старт: Как опубликовать обновление

**Самый простой способ (автоматический):**

1. Обновите версию в `package.json` (например, `1.0.0` → `1.0.1`)
2. Закоммитьте изменения: `git commit -am "Bump version to 1.0.1"`
3. Создайте и запушьте tag: `git tag v1.0.1 && git push origin v1.0.1`
4. GitHub Actions автоматически соберет и опубликует релиз
5. Приложения сотрудников автоматически получат обновление в течение 30 минут

**Ручной способ:**

1. Обновите версию в `package.json`
2. Соберите: `npm run build:win`
3. Создайте GitHub Release и загрузите файлы из `release/`

Подробности ниже ↓

---

## Процесс обновления приложения

Приложение использует автоматическое обновление через GitHub Releases. Когда вы публикуете новый релиз на GitHub, все установленные копии приложения автоматически получат уведомление об обновлении.

### Как работает автообновление

1. **Проверка обновлений:**
   - При запуске приложения
   - Каждые 30 минут автоматически
   - При активации окна приложения

2. **Процесс обновления:**
   - Приложение проверяет наличие новых версий на GitHub
   - Если найдена новая версия, она скачивается в фоне
   - Пользователю показывается уведомление о готовности обновления
   - Пользователь может перезапустить приложение сразу или отложить на 5 секунд

## Процесс публикации обновления

### Шаг 1: Внесите изменения в код

Внесите необходимые изменения в код приложения.

### Шаг 2: Обновите версию

Обновите версию в `package.json`:

```json
{
  "version": "1.0.1"  // Увеличьте версию (1.0.0 -> 1.0.1 -> 1.0.2 и т.д.)
}
```

**Важно:** Версия должна быть выше предыдущей. Используйте [семантическое версионирование](https://semver.org/):
- `1.0.1` - патч (исправления багов)
- `1.1.0` - минорное обновление (новые функции)
- `2.0.0` - мажорное обновление (breaking changes)

### Шаг 3: Соберите приложение

```bash
npm run build:win
```

Это создаст установщик в папке `release/`.

## Способ 2: Ручная публикация

Если вы предпочитаете публиковать релизы вручную:

### Шаг 4: Создайте GitHub Release

1. Перейдите на GitHub в репозиторий: https://github.com/Revoool/chat.goranked
2. Нажмите "Releases" → "Create a new release"
3. Заполните форму:
   - **Tag version:** `v1.0.1` (соответствует версии из package.json, создайте новый tag)
   - **Release title:** `GoRanked Chat Desk v1.0.1` (или описание изменений)
   - **Description:** Опишите изменения в этом релизе
4. Загрузите файлы из папки `release/`:
   - `GoRanked Chat Desk-Setup-1.0.1.exe` (установщик)
   - `latest.yml` (метаданные для автообновления - **обязательно!**)
   - `GoRanked Chat Desk-Setup-1.0.1.exe.blockmap` (опционально, для проверки целостности)
5. Нажмите "Publish release"

**Важно:** Файл `latest.yml` критически важен для работы автообновления. Без него приложения не смогут обнаружить новую версию.

### Шаг 5: Проверка

После публикации релиза:
- Приложения сотрудников автоматически обнаружат обновление в течение 30 минут
- Или при следующем запуске приложения
- Пользователи получат уведомление о доступности обновления

## Способ 1: Автоматическая публикация (Рекомендуется)

В проекте уже настроен GitHub Actions workflow (`.github/workflows/build.yml`), который автоматически собирает и публикует релизы.

**Процесс:**

1. **Обновите версию в `package.json`:**
   ```json
   {
     "version": "1.0.1"
   }
   ```

2. **Закоммитьте и запушьте изменения:**
   ```bash
   git add package.json
   git commit -m "Bump version to 1.0.1"
   git push
   ```

3. **Создайте и запушьте git tag:**
   ```bash
   git tag v1.0.1
   git push origin v1.0.1
   ```

4. **GitHub Actions автоматически:**
   - Соберет приложение для Windows и macOS
   - Создаст GitHub Release
   - Загрузит установщики и файлы для автообновления

**Важно:** Убедитесь, что файл `latest.yml` также загружен в релиз (он создается автоматически electron-builder и нужен для автообновления).

## Ручное распространение (без автообновления)

Если вы не хотите использовать GitHub Releases, вы можете:

1. Собрать приложение: `npm run build:win`
2. Распространить файл `release/GoRanked Chat Desk-Setup-X.X.X.exe` сотрудникам
3. Они должны будут установить новую версию вручную

## Настройка автообновления

### Изменение репозитория GitHub

Если репозиторий изменился, обновите настройки в `src/main/main.ts`:

```typescript
autoUpdater.setFeedURL({
  provider: 'github',
  owner: 'YOUR_GITHUB_USERNAME',  // Измените здесь
  repo: 'YOUR_REPO_NAME',         // Измените здесь
});
```

Или установите переменные окружения при сборке:
```bash
GITHUB_OWNER=YourUsername GITHUB_REPO=your-repo npm run build:win
```

### Использование собственного сервера обновлений

Если вы хотите использовать свой сервер вместо GitHub:

1. Установите переменную окружения `UPDATE_URL` при сборке
2. Или измените код в `src/main/main.ts` для использования `generic` провайдера

## Отладка автообновления

Если автообновление не работает:

1. Проверьте, что приложение упаковано (`app.isPackaged === true`)
2. Проверьте логи в консоли (F12 или Ctrl+Shift+I)
3. Убедитесь, что GitHub Release создан правильно
4. Проверьте, что файл `latest.yml` загружен в релиз
5. Убедитесь, что версия в `package.json` выше текущей установленной версии

## Часто задаваемые вопросы

**Q: Как отключить автообновление?**
A: Закомментируйте код автообновления в `src/main/main.ts` или установите `app.isPackaged = false` (не рекомендуется).

**Q: Можно ли сделать принудительное обновление?**
A: Да, измените логику в `src/main/main.ts` - вместо диалога сразу вызывайте `autoUpdater.quitAndInstall()`.

**Q: Как проверить текущую версию приложения?**
A: Версия отображается в `package.json` и в названии установщика.

**Q: Что делать, если обновление не устанавливается?**
A: Проверьте права доступа к папке установки. Пользователь должен иметь права на запись в директорию приложения.

